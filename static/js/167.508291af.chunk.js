(this["webpackJsonpcopernicus-react-arcgis-map"]=this["webpackJsonpcopernicus-react-arcgis-map"]||[]).push([[167],{805:function(e,t,i){"use strict";i.r(t);var a=i(27),n=i(8),r=i.n(n),u=i(18),s=i(2),l=i(3),c=i(40),h=i(39),o=i(4),f=i(5),p=i(0),d=(i(12),i(11),i(14),i(1)),y=i(6),v=(i(9),i(15),i(16),i(20)),b=i(46),_=i(55),w=i(288),k=i(361),O=i(421),m=i(422),g=i(470),j=i(471),S=i(713),x=[102113,102100,3857,3785,900913],I=function(e){Object(o.a)(i,e);var t=Object(f.a)(i);function i(){var e;return Object(s.a)(this,i),(e=t.apply(this,arguments))._handles=new _.a,e._tileStrategy=null,e._fetchQueue=null,e._tileRequests=new Map,e.layer=null,e}return Object(l.a)(i,[{key:"tileMatrixSet",get:function(){if(this.layer.activeLayer.tileMatrixSetId)return this.layer.activeLayer.tileMatrixSet;var e=this._getTileMatrixSetBySpatialReference(this.layer.activeLayer);return e?(this.layer.activeLayer.tileMatrixSetId=e.id,e):null}},{key:"hitTest",value:function(){return null}},{key:"update",value:function(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume(),this.notifyChange("updating")}},{key:"attach",value:function(){var e=this,t=this.layer.activeLayer,a=this.tileMatrixSet;if(a){var n=a.tileInfo.spatialReference,r=t.fullExtent&&t.fullExtent.clone();n.isWebMercator?r=Object(b.b)(r):n.isWGS84||(r=a.fullExtent),this._tileInfoView=new k.a(a.tileInfo,r),this._fetchQueue=new O.a({tileInfoView:this._tileInfoView,process:function(t){return e.fetchTile(t)}}),this._tileStrategy=new m.a({cachePolicy:"keep",acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},tileInfoView:this._tileInfoView}),this._handles.add(this.watch(["layer.activeLayer.styleId","tileMatrixSet"],(function(){return e._refresh()}))),Object(c.a)(Object(h.a)(i.prototype),"attach",this).call(this)}}},{key:"detach",value:function(){Object(c.a)(Object(h.a)(i.prototype),"detach",this).call(this),this._handles.removeAll(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"doRefresh",value:function(){var e=Object(u.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateRequested||this.suspended||this._refresh();case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isUpdating",value:function(){return this._fetchQueue.length>0}},{key:"acquireTile",value:function(e){var t,i,n,r,u=this,s=this._bitmapView.createTile(e),l=s.bitmap;t=this._tileInfoView.getTileCoords([0,0],s.key),i=Object(a.a)(t,2),l.x=i[0],l.y=i[1],l.resolution=this._tileInfoView.getTileResolution(s.key),n=this._tileInfoView.tileInfo.size,r=Object(a.a)(n,2),l.width=r[0],l.height=r[1],this._tileInfoView.getTileCoords(l,s.key);var c={id:e.id,fulfilled:!1,promise:this._fetchQueue.push(s.key).then((function(e){s.bitmap.source=e,s.once("attach",(function(){return u.requestUpdate()})),u._bitmapView.addChild(s)})).catch((function(e){Object(v.m)(e)||(s.bitmap.source=null,s.once("attach",(function(){return u.requestUpdate()})),u._bitmapView.addChild(s))}))};return c.promise.finally((function(){return c.fulfilled=!0})),this._tileRequests.set(s,c),this.requestUpdate(),s}},{key:"releaseTile",value:function(e){var t=this._tileRequests.get(e);t.fulfilled||this._fetchQueue.abort(t.id),this._tileRequests.delete(e),this._bitmapView.removeChild(e),e.once("detach",(function(){return e.destroy()})),this.requestUpdate()}},{key:"fetchTile",value:function(){var e=Object(u.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.layer.fetchTile(t.level,t.row,t.col));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"canResume",value:function(){var e=Object(c.a)(Object(h.a)(i.prototype),"canResume",this).call(this);return e?null!==this.tileMatrixSet:e}},{key:"_refresh",value:function(){var e=this;this._fetchQueue.reset(),this._tileStrategy.tiles.forEach((function(t){if(t.bitmap.source){t.bitmap.source=null;var i={id:t.key.id,fulfilled:!1,promise:e._fetchQueue.push(t.key).then((function(i){t.bitmap.source=i,t.requestRender(),e.notifyChange("updating")}))};i.promise.then((function(){return i.fulfilled=!0}),(function(){return i.fulfilled=!0})),e._tileRequests.set(t,i)}})),this.notifyChange("updating")}},{key:"_getTileMatrixSetBySpatialReference",value:function(e){var t=this.view.spatialReference;if(!e.tileMatrixSets)return null;var i=e.tileMatrixSets.find((function(e){return e.tileInfo.spatialReference.wkid===t.wkid}));return!i&&t.isWebMercator&&(i=e.tileMatrixSets.find((function(e){return x.indexOf(e.tileInfo.spatialReference.wkid)>-1}))),i}}]),i}(Object(w.a)(Object(S.a)(Object(j.a)(g.a))));Object(p.a)([Object(d.b)()],I.prototype,"suspended",void 0),Object(p.a)([Object(d.b)({readOnly:!0})],I.prototype,"tileMatrixSet",null);var q=I=Object(p.a)([Object(y.a)("esri.views.2d.layers.WMTSLayerView2D")],I);t.default=q}}]);
//# sourceMappingURL=167.508291af.chunk.js.map