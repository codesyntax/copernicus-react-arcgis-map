(this["webpackJsonpcopernicus-react-arcgis-map"]=this["webpackJsonpcopernicus-react-arcgis-map"]||[]).push([[90],{591:function(e,t,r){"use strict";var a=r(2),n=r(4),i=r(5),s=r(0),o=(r(12),r(11),r(14),r(1)),c=r(35),u=r(6),l=(r(9),r(15),r(16),r(21)),b=new c.a({esriJobMessageTypeInformative:"informative",esriJobMessageTypeProcessDefinition:"process-definition",esriJobMessageTypeProcessStart:"process-start",esriJobMessageTypeProcessStop:"process-stop",esriJobMessageTypeWarning:"warning",esriJobMessageTypeError:"error",esriJobMessageTypeEmpty:"empty",esriJobMessageTypeAbort:"abort"}),p=function(e){Object(n.a)(r,e);var t=Object(i.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).description=null,n.type=null,n}return r}(l.a);Object(s.a)([Object(o.b)({type:String,json:{write:!0}})],p.prototype,"description",void 0),Object(s.a)([Object(o.b)({type:String,json:{read:b.read,write:b.write}})],p.prototype,"type",void 0);var f=p=Object(s.a)([Object(u.a)("esri.tasks.support.GPMessage")],p);t.a=f},894:function(e,t,r){"use strict";r.r(t);var a=r(13),n=r(8),i=r.n(n),s=r(38),o=r(10),c=r(18),u=r(2),l=r(3),b=r(4),p=r(5),f=r(0),y=(r(12),r(7)),d=(r(11),r(14)),h=r(1),m=r(35),v=r(6),O=r(17),g=r(9),j=(r(15),r(16),r(91)),S=r(33),x=r(73),k=r(50),w=r(380),_=r(76),P=r(368),L=r(34),J=r(47),M=r(28),N=function(e){Object(b.a)(r,e);var t=Object(p.a)(r);function r(){var e;return Object(u.a)(this,r),(e=t.apply(this,arguments)).outSpatialReference=null,e.processExtent=null,e.processSpatialReference=null,e.returnFeatureCollection=!1,e.returnM=!1,e.returnZ=!1,e}return r}(M.a);Object(f.a)([Object(h.b)({type:L.a})],N.prototype,"outSpatialReference",void 0),Object(f.a)([Object(h.b)({type:J.a})],N.prototype,"processExtent",void 0),Object(f.a)([Object(h.b)({type:L.a})],N.prototype,"processSpatialReference",void 0),Object(f.a)([Object(h.b)({nonNullable:!0})],N.prototype,"returnFeatureCollection",void 0),Object(f.a)([Object(h.b)({nonNullable:!0})],N.prototype,"returnM",void 0),Object(f.a)([Object(h.b)({nonNullable:!0})],N.prototype,"returnZ",void 0),(N=Object(f.a)([Object(v.a)("esri/rest/geoprocessor/GPOptions")],N)).from=Object(d.m)(N);var I=N,D=r(591),G=r(280),T=r(190),V=r(129),R=r(113),F=r(21),C=function(e){Object(b.a)(r,e);var t=Object(p.a)(r);function r(){var e;return Object(u.a)(this,r),(e=t.apply(this,arguments)).extent=null,e.height=null,e.href=null,e.opacity=1,e.rotation=0,e.scale=null,e.visible=!0,e.width=null,e}return r}(F.a);Object(f.a)([Object(h.b)({type:J.a})],C.prototype,"extent",void 0),Object(f.a)([Object(h.b)()],C.prototype,"height",void 0),Object(f.a)([Object(h.b)()],C.prototype,"href",void 0),Object(f.a)([Object(h.b)()],C.prototype,"opacity",void 0),Object(f.a)([Object(h.b)()],C.prototype,"rotation",void 0),Object(f.a)([Object(h.b)()],C.prototype,"scale",void 0),Object(f.a)([Object(h.b)()],C.prototype,"visible",void 0),Object(f.a)([Object(h.b)()],C.prototype,"width",void 0);var E=C=Object(f.a)([Object(v.a)("esri.layer.support.MapImage")],C),A=function(e){Object(b.a)(r,e);var t=Object(p.a)(r);function r(e){var a;return Object(u.a)(this,r),(a=t.call(this,e)).itemId=null,a.url=null,a}return r}(F.a);Object(f.a)([Object(h.b)({type:String,json:{read:{source:"itemID"},write:{target:"itemID"}}})],A.prototype,"itemId",void 0),Object(f.a)([Object(h.b)({type:String,json:{write:!0}})],A.prototype,"url",void 0);var U=A=Object(f.a)([Object(v.a)("esri.tasks.support.DataFile")],A),q=new m.a({esriMeters:"meters",esriFeet:"feet",esriKilometers:"kilometers",esriMiles:"miles",esriNauticalMiles:"nautical-miles",esriYards:"yards"},{ignoreUnknown:!1}),z=function(e){Object(b.a)(r,e);var t=Object(p.a)(r);function r(e){var a;return Object(u.a)(this,r),(a=t.call(this,e)).distance=0,a.units=null,a}return r}(F.a);Object(f.a)([Object(h.b)({json:{write:!0}})],z.prototype,"distance",void 0),Object(f.a)([Object(h.b)({json:{read:q.read,write:q.write}})],z.prototype,"units",void 0);var W=z=Object(f.a)([Object(v.a)("esri/tasks/support/LinearUnit")],z),Z=new m.a({GPBoolean:"boolean",GPDataFile:"data-file",GPDate:"date",GPDouble:"double",GPFeatureRecordSetLayer:"feature-record-set-layer",GPField:"field",GPLinearUnit:"linear-unit",GPLong:"long",GPRasterData:"raster-data",GPRasterDataLayer:"raster-data-layer",GPRecordSet:"record-set",GPString:"string","GPMultiValue:GPBoolean":"multi-value","GPMultiValue:GPDataFile":"multi-value","GPMultiValue:GPDate":"multi-value","GPMultiValue:GPDouble":"multi-value","GPMultiValue:GPFeatureRecordSetLayer":"multi-value","GPMultiValue:GPField":"multi-value","GPMultiValue:GPLinearUnit":"multi-value","GPMultiValue:GPLong":"multi-value","GPMultiValue:GPRasterData":"multi-value","GPMultiValue:GPRasterDataLayer":"multi-value","GPMultiValue:GPRecordSet":"multi-value","GPMultiValue:GPString":"multi-value"}),B=function(e){Object(b.a)(r,e);var t=Object(p.a)(r);function r(e){var a;return Object(u.a)(this,r),(a=t.call(this,e)).dataType=null,a.value=null,a}return r}(F.a);Object(f.a)([Object(h.b)({json:{read:Z.read,write:Z.write}})],B.prototype,"dataType",void 0),Object(f.a)([Object(h.b)()],B.prototype,"value",void 0);var K=B=Object(f.a)([Object(v.a)("esri.tasks.support.ParameterValue")],B),Q=function(e){Object(b.a)(r,e);var t=Object(p.a)(r);function r(e){var a;return Object(u.a)(this,r),(a=t.call(this,e)).format=null,a.itemId=null,a.url=null,a}return r}(F.a);Object(f.a)([Object(h.b)()],Q.prototype,"format",void 0),Object(f.a)([Object(h.b)({json:{read:{source:"itemID"},write:{target:"itemID"}}})],Q.prototype,"itemId",void 0),Object(f.a)([Object(h.b)()],Q.prototype,"url",void 0);var Y=Q=Object(f.a)([Object(v.a)("esri/tasks/support/RasterData")],Q);function H(e,t,r,a,n){return $.apply(this,arguments)}function $(){return($=Object(c.a)(i.a.mark((function e(t,r,n,s,o){var c,u,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c={},u={},l=[],e.abrupt("return",(X(s,l,c),Object(G.a)(l).then((function(e){var i=n.outSpatialReference,l=n.processExtent,b=n.processSpatialReference,p=n.returnFeatureCollection,f=n.returnM,y=n.returnZ,d=Object(R.c)(t).path;for(var h in c){var m=c[h];u[h]=e.slice(m[0],m[1])}var v=i?i.wkid||i:null,O=b?b.wkid||b:null,g="execute"===r?{returnFeatureCollection:p||void 0,returnM:f||void 0,returnZ:y||void 0}:null,j=te(Object(a.a)(Object(a.a)(Object(a.a)(Object(a.a)({},l?{context:{extent:l,outSR:v,processSR:O}}:{"env:outSR":v,"env:processSR":O}),s),g),{},{f:"json"}),null,u),S=Object(a.a)(Object(a.a)({},o),{},{query:j});return Object(k.default)("".concat(d,"/").concat(r),S)}))));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e,t,r){for(var a in e){var n=e[a];if(n&&"object"==typeof n&&n instanceof V.default){var i=n.features;r[a]=[t.length,t.length+i.length],i.forEach((function(e){t.push(e.geometry)}))}}}function ee(e){var t=e.dataType,r=K.fromJSON(e);switch(t){case"GPBoolean":case"GPDouble":case"GPLong":case"GPString":return r;case"GPDate":r.value=new Date(r.value);break;case"GPDataFile":r.value=U.fromJSON(r.value);break;case"GPLinearUnit":r.value=W.fromJSON(r.value);break;case"GPFeatureRecordSetLayer":case"GPRecordSet":var a=e.value.url;r.value=a?U.fromJSON(r.value):V.default.fromJSON(r.value);break;case"GPRasterData":case"GPRasterDataLayer":var n=e.value.mapImage;r.value=n?E.fromJSON(n):Y.fromJSON(r.value);break;case"GPField":r.value=T.a.fromJSON(r.value);break;case"GPMultiValue:GPBoolean":case"GPMultiValue:GPDouble":case"GPMultiValue:GPLong":case"GPMultiValue:GPString":return r;case"GPMultiValue:GPDate":var i=r.value;r.value=i.map((function(e){return new Date(e)}));break;case"GPMultiValue:GPDataFile":r.value=r.value.map((function(e){return U.fromJSON(e)}));break;case"GPMultiValue:GPLinearUnit":r.value=r.value.map((function(e){return W.fromJSON(e)}));break;case"GPMultiValue:GPFeatureRecordSetLayer":case"GPMultiValue:GPRecordSet":r.value=r.value.map((function(e){return V.default.fromJSON(e)}));break;case"GPMultiValue:GPRasterData":case"GPMultiValue:GPRasterDataLayer":r.value=r.value.map((function(e){return e?E.fromJSON(e):Y.fromJSON(r.value)}));break;case"GPMultiValue:GPField":r.value=r.value.map((function(e){return T.a.fromJSON(e)}))}return r}function te(e,t,r){for(var a in e){var n=e[a];Array.isArray(n)?e[a]=JSON.stringify(n.map((function(e){return te({item:e},!0).item}))):n instanceof Date&&(e[a]=n.getTime())}return Object(R.b)(e,t,r)}function re(){return(re=Object(c.a)(i.a.mark((function e(t,r,a,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(a=I.from(a),H(t,"execute",a,r,n).then((function(e){var t=e.data.results||[],r=e.data.messages||[];return{results:t.map(ee),messages:r.map((function(e){return D.a.fromJSON(e)}))}}))));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ae,ne=r(20),ie=new m.a({esriJobCancelled:"job-cancelled",esriJobCancelling:"job-cancelling",esriJobDeleted:"job-deleted",esriJobDeleting:"job-deleting",esriJobTimedOut:"job-timed-out",esriJobExecuting:"job-executing",esriJobFailed:"job-failed",esriJobNew:"job-new",esriJobSubmitted:"job-submitted",esriJobSucceeded:"job-succeeded",esriJobWaiting:"job-waiting"}),se=ae=function(e){Object(b.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(u.a)(this,n),(r=t.call(this,e)).jobId=null,r.jobStatus=null,r.messages=null,r.requestOptions=null,r.sourceUrl=null,r._timer=null,r}return Object(l.a)(n,[{key:"cancelJob",value:function(e){var t=this,r=this.jobId,n=this.sourceUrl,i=Object(R.c)(n).path,s=Object(a.a)(Object(a.a)(Object(a.a)({},this.requestOptions),e),{},{query:{f:"json"}});return this._clearTimer(),Object(k.default)("".concat(i,"/jobs/").concat(r,"/cancel"),s).then((function(e){var r=ae.fromJSON(e.data);return t.messages=r.messages,t.jobStatus=r.jobStatus,t}))}},{key:"destroy",value:function(){clearInterval(this._timer)}},{key:"checkJobStatus",value:function(e){var t=this,r=Object(R.c)(this.sourceUrl).path,n=Object(a.a)(Object(a.a)(Object(a.a)({},this.requestOptions),e),{},{query:{f:"json"}}),i="".concat(r,"/jobs/").concat(this.jobId);return Object(k.default)(i,n).then((function(e){var r=e.data,a=ae.fromJSON(r);return t.messages=a.messages,t.jobStatus=a.jobStatus,t}))}},{key:"fetchResultData",value:function(e,t,r){var n=t=I.from(t),i=n.returnFeatureCollection,s=n.returnM,o=n.returnZ,c=n.outSpatialReference,u=Object(R.c)(this.sourceUrl).path,l=te({returnFeatureCollection:i||void 0,returnM:s||void 0,returnZ:o||void 0,outSR:c,returnType:"data",f:"json"},null),b=Object(a.a)(Object(a.a)(Object(a.a)({},this.requestOptions),r),{},{query:l}),p="".concat(u,"/jobs/").concat(this.jobId,"/results/").concat(e);return Object(k.default)(p,b).then((function(e){return ee(e.data)}))}},{key:"fetchResultImage",value:function(e,t,r){var n=Object(R.c)(this.sourceUrl).path,i=te(Object(a.a)(Object(a.a)({},t.toJSON()),{},{f:"json"})),s=Object(a.a)(Object(a.a)(Object(a.a)({},this.requestOptions),r),{},{query:i}),o="".concat(n,"/jobs/").concat(this.jobId,"/results/").concat(e);return Object(k.default)(o,s).then((function(e){return ee(e.data)}))}},{key:"fetchResultMapImageLayer",value:function(){var e=Object(c.a)(i.a.mark((function e(){var t,a,n,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(R.c)(this.sourceUrl),a=t.path,n=a.indexOf("/GPServer/"),s="".concat(a.substring(0,n),"/MapServer/jobs/").concat(this.jobId),e.next=4,r.e(30).then(r.bind(null,610));case 4:return e.t0=e.sent.default,e.t1={url:s},e.abrupt("return",new e.t0(e.t1));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"waitForJobCompletion",value:function(){var e=Object(c.a)(i.a.mark((function e(){var t,r,a,n,s,o=this,c=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:{},r=t.interval,a=void 0===r?1e3:r,n=t.signal,s=t.statusCallback,e.abrupt("return",new Promise((function(e,t){Object(ne.p)(n,(function(){o._clearTimer(),t(Object(ne.e)())})),o._clearTimer();var r=setInterval((function(){o._timer||t(Object(ne.e)()),o.checkJobStatus(o.requestOptions).then((function(r){var a=r.jobStatus;switch(o.jobStatus=a,a){case"job-succeeded":o._clearTimer(),e(o);break;case"job-submitted":case"job-executing":case"job-waiting":case"job-new":s&&s(o);break;case"job-cancelled":case"job-cancelling":case"job-deleted":case"job-deleting":case"job-timed-out":case"job-failed":o._clearTimer(),t(o)}}))}),a);o._timer=r})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_clearTimer",value:function(){this._timer&&(clearInterval(this._timer),this._timer=null)}}]),n}(F.a);Object(f.a)([Object(h.b)()],se.prototype,"jobId",void 0),Object(f.a)([Object(h.b)({json:{read:ie.read}})],se.prototype,"jobStatus",void 0),Object(f.a)([Object(h.b)({type:[D.a]})],se.prototype,"messages",void 0),Object(f.a)([Object(h.b)()],se.prototype,"requestOptions",void 0),Object(f.a)([Object(h.b)({json:{write:!0}})],se.prototype,"sourceUrl",void 0);var oe=se=ae=Object(f.a)([Object(v.a)("esri.tasks.support.JobInfo")],se);function ce(){return(ce=Object(c.a)(i.a.mark((function e(t,r,a,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(a=I.from(a),H(t,"submitJob",a,r,n).then((function(e){var r=oe.fromJSON(e.data);return r.sourceUrl=t,r}))));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ue=function(e){Object(b.a)(r,e);var t=Object(p.a)(r);function r(e){var a;return Object(u.a)(this,r),(a=t.call(this,e))._jobs=new Map,a.outSpatialReference=null,a.processExtent=null,a.processSpatialReference=null,a.returnFeatureCollection=!1,a.returnM=!1,a.returnZ=!1,a}return Object(l.a)(r,[{key:"destroy",value:function(){this._jobs.forEach((function(e){return e.destroy()})),this._jobs.clear()}},{key:"cancelJob",value:function(e,t){var r=this._jobs.get(e),n=Object(a.a)(Object(a.a)({},this.requestOptions),t);return r.cancelJob(n)}},{key:"checkJobStatus",value:function(e,t){var r=this._jobs.get(e),n=Object(a.a)(Object(a.a)({},this.requestOptions),t);return r.checkJobStatus(n)}},{key:"execute",value:function(e,t){var r=new I({outSpatialReference:this.outSpatialReference,processExtent:this.processExtent,processSpatialReference:this.processSpatialReference,returnFeatureCollection:this.returnFeatureCollection,returnM:this.returnM,returnZ:this.returnZ}),n=Object(a.a)(Object(a.a)({},this.requestOptions),t);return function(e,t,r,a){return re.apply(this,arguments)}(this.url,e,r,n)}},{key:"getResultData",value:function(e,t,r){var n=this._jobs.get(e),i=this.returnFeatureCollection,s=this.returnM,o=this.returnZ,c=this.outSpatialReference,u=new I({returnFeatureCollection:i,returnM:s,returnZ:o,outSpatialReference:c,url:this.url}),l=Object(a.a)(Object(a.a)({},this.requestOptions),r);return n.fetchResultData(t,u,l)}},{key:"getResultImage",value:function(e,t,r,n){var i=this._jobs.get(e),s=Object(a.a)(Object(a.a)({},this.requestOptions),n);return i.fetchResultImage(t,r,s)}},{key:"getResultMapImageLayer",value:function(){var e=Object(c.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._jobs.get(t).fetchResultMapImageLayer());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"submitJob",value:function(e,t){var r=this,n=new I({outSpatialReference:this.outSpatialReference,processExtent:this.processExtent,processSpatialReference:this.processSpatialReference,returnFeatureCollection:this.returnFeatureCollection,returnM:this.returnM,returnZ:this.returnZ}),i=Object(a.a)(Object(a.a)({},this.requestOptions),t);return function(e,t,r,a){return ce.apply(this,arguments)}(this.url,e,n,i).then((function(e){return e.sourceUrl=r.url,r._jobs.set(e.jobId,e),e}))}},{key:"waitForJobCompletion",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._jobs.get(e).waitForJobCompletion(t)}}]),r}(P.a);Object(f.a)([Object(h.b)({type:L.a})],ue.prototype,"outSpatialReference",void 0),Object(f.a)([Object(h.b)({type:J.a})],ue.prototype,"processExtent",void 0),Object(f.a)([Object(h.b)({type:L.a})],ue.prototype,"processSpatialReference",void 0),Object(f.a)([Object(h.b)({nonNullable:!0})],ue.prototype,"returnFeatureCollection",void 0),Object(f.a)([Object(h.b)({nonNullable:!0})],ue.prototype,"returnM",void 0),Object(f.a)([Object(h.b)({nonNullable:!0})],ue.prototype,"returnZ",void 0);var le=ue=Object(f.a)([Object(v.a)("esri/tasks/Geoprocessor")],ue),be=new m.a({PDF:"pdf",PNG32:"png32",PNG8:"png8",JPG:"jpg",GIF:"gif",EPS:"eps",SVG:"svg",SVGZ:"svgz"}),pe=(be.fromJSON.bind(be),be.toJSON.bind(be)),fe=new m.a({MAP_ONLY:"map-only","A3 Landscape":"a3-landscape","A3 Portrait":"a3-portrait","A4 Landscape":"a4-landscape","A4 Portrait":"a4-portrait","Letter ANSI A Landscape":"letter-ansi-a-landscape","Letter ANSI A Portrait":"letter-ansi-a-portrait","Tabloid ANSI B Landscape":"tabloid-ansi-b-landscape","Tabloid ANSI B Portrait":"tabloid-ansi-b-portrait"}),ye=(fe.fromJSON.bind(fe),fe.toJSON.bind(fe)),de="simple-marker",he="simple-line";function me(e,t){var r=t.graphic,a=t.renderer,n=t.symbol,i=n.type;if("text"!==i&&"shield-label-symbol"!==i&&"visualVariables"in a&&a.visualVariables){var s=a.getVisualVariablesForType("size"),o=a.getVisualVariablesForType("color"),c=a.getVisualVariablesForType("opacity"),u=a.getVisualVariablesForType("rotation"),l=s&&s[0],b=o&&o[0],p=c&&c[0],f=u&&u[0];if(l){var y=i===de?n.style:null,d=Object(w.getSize)(l,r,{shape:y});null!=d&&(i===de?e.size=Object(S.e)(d):"picture-marker"===i?(e.width=Object(S.e)(d),e.height=Object(S.e)(d)):i===he?e.width=Object(S.e)(d):e.outline&&(e.outline.width=Object(S.e)(d)))}if(b){var h=Object(w.getColor)(b,r);(h&&i===de||i===he||"simple-fill"===i)&&(e.color=h?h.toJSON():void 0)}if(p){var m=Object(w.getOpacity)(p,r);null!=m&&e.color&&(e.color[3]=Math.round(255*m))}f&&(e.angle=-Object(w.getRotationAngle)(a,r))}}function ve(e){var t,r,a,n,i,s,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,c=e.canvas.width,u=e.canvas.height,l=e.getImageData(0,0,c,u).data;e:for(r=u;r--;)for(t=c;t--;)if(l[4*(c*r+t)+3]>o){s=r;break e}if(!s)return null;e:for(t=c;t--;)for(r=s+1;r--;)if(l[4*(c*r+t)+3]>o){i=t;break e}e:for(t=0;t<=i;++t)for(r=s+1;r--;)if(l[4*(c*r+t)+3]>o){a=t;break e}e:for(r=0;r<=s;++r)for(t=a;t<=i;++t)if(l[4*(c*r+t)+3]>o){n=r;break e}return{x:a,y:n,width:i-a,height:s-n}}function Oe(e,t){var r=e.allLayerViews.items;if(t===e.scale)return r.filter((function(e){return!e.suspended}));var a,n=new Array,i=Object(o.a)(r);try{for(i.s();!(a=i.n()).done;){var s=a.value;_e(s.parent)&&!n.includes(s.parent)||!s.visible||t&&"isVisibleAtScale"in s&&!s.isVisibleAtScale(t)||n.push(s)}}catch(c){i.e(c)}finally{i.f()}return n}function ge(e){return e&&"bing-maps"===e.type}function je(e){return e&&"csv"===e.type}function Se(e){return e&&"feature"===e.type}function xe(e){return e&&"geojson"===e.type}function ke(e){return e&&"graphics"===e.type}function we(e){return e&&"group"===e.type}function _e(e){return e&&"esri.views.2d.layers.GroupLayerView2D"===e.declaredClass}function Pe(e){return e&&"imagery"===e.type}function Le(e){return e&&"kml"===e.type}function Je(e){return e&&"map-image"===e.type}function Me(e){return e&&"map-notes"===e.type}function Ne(e){return e&&"open-street-map"===e.type}function Ie(e){return e&&"stream"===e.type}function De(e){return e&&"tile"===e.type}function Ge(e){return e&&"vector-tile"===e.type}function Te(e){return e&&"web-tile"===e.type}function Ve(e){return e&&"wms"===e.type}function Re(e){return e&&"wmts"===e.type}var Fe=function(e){Object(b.a)(r,e);var t=Object(p.a)(r);function r(e){var a;return Object(u.a)(this,r),(a=t.call(this,e)).attributionVisible=!0,a.exportOptions={width:800,height:1100,dpi:96},a.forceFeatureAttributes=!1,a.format="png32",a.label=null,a.layout="map-only",a.layoutOptions=null,a.outScale=0,a.scalePreserved=!0,a.showLabels=!0,a}return r}(M.a);Object(f.a)([Object(h.b)()],Fe.prototype,"attributionVisible",void 0),Object(f.a)([Object(h.b)()],Fe.prototype,"exportOptions",void 0),Object(f.a)([Object(h.b)()],Fe.prototype,"forceFeatureAttributes",void 0),Object(f.a)([Object(h.b)()],Fe.prototype,"format",void 0),Object(f.a)([Object(h.b)()],Fe.prototype,"label",void 0),Object(f.a)([Object(h.b)()],Fe.prototype,"layout",void 0),Object(f.a)([Object(h.b)()],Fe.prototype,"layoutOptions",void 0),Object(f.a)([Object(h.b)()],Fe.prototype,"outScale",void 0),Object(f.a)([Object(h.b)()],Fe.prototype,"scalePreserved",void 0),Object(f.a)([Object(h.b)()],Fe.prototype,"showLabels",void 0);var Ce=Fe=Object(f.a)([Object(v.a)("esri.tasks.support.PrintTemplate")],Fe),Ee={Feet:"ft",Kilometers:"km",Meters:"m",Miles:"mi"},Ae=new m.a({esriFeet:"Feet",esriKilometers:"Kilometers",esriMeters:"Meters",esriMiles:"Miles"}),Ue=new m.a({esriExecutionTypeSynchronous:"sync",esriExecutionTypeAsynchronous:"async"}),qe=new _.a({returnGeometry:!0});function ze(e){return e&&(e.path||"image/svg+xml"===e.contentType||e.url&&e.url.endsWith(".svg"))}var We=function(e){Object(b.a)(r,e);var t=Object(p.a)(r);function r(){var e;Object(u.a)(this,r);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n)))._ssExtent=null,e._legendLayers=[],e._legendLayerNameMap={},e._gpServerUrl=null,e._cimVersion=null,e._is11xService=!1,e._gpMetadata=null,e.updateDelay=1e3,e}return Object(l.a)(r,[{key:"_geoprocessor",get:function(){return new le({url:this.url})}},{key:"mode",get:function(){return this._gpMetadata&&this._gpMetadata.executionType?Ue.fromJSON(this._gpMetadata.executionType):"sync"}},{key:"execute",value:function(e,t){var r=this,a=this.url,n=a.lastIndexOf("/GPServer/");return n>0&&(a=a.slice(0,n+9)),Promise.resolve().then((function(){return r._gpServerUrl===a?{data:r._gpMetadata}:(r._gpServerUrl=a,Object(k.default)(a,{query:{f:"json"}}))})).then((function(t){return r._gpMetadata=t.data,r._cimVersion=r._gpMetadata.cimVersion,r._is11xService=!!r._cimVersion,r._getGpPrintParams(e)})).then((function(e){var a=function(e){return"sync"===r.mode?e.results&&e.results[0]&&e.results[0].value:r._geoprocessor.getResultData(e.jobId,"Output_File",t).then((function(e){return e.value}))};return"async"===r.mode?r._geoprocessor.submitJob(e,t).then((function(e){return r._geoprocessor.waitForJobCompletion(e.jobId,{interval:r.updateDelay}).then(a)})):r._geoprocessor.execute(e,t).then(a)}))}},{key:"_createOperationalLayers",value:function(){var e=Object(c.a)(i.a.mark((function e(t,r){var a,n,c,u,l,b,p,f,y,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],n={layerView:null,printTemplate:r,view:t},c=0,r.scalePreserved&&(c=r.outScale||t.scale),u=Oe(t,c),l=Object(o.a)(u),e.prev=5,l.s();case 7:if((b=l.n()).done){e.next=116;break}if(p=b.value,(f=p.layer).loaded&&!we(f)){e.next=12;break}return e.abrupt("continue",114);case 12:if(y=void 0,n.layerView=p,!ge(f)){e.next=18;break}e.t0=this._createBingMapsLayerJSON(f),e.next=112;break;case 18:if(!je(f)){e.next=24;break}return e.next=21,this._createCSVLayerJSON(f,n);case 21:e.t1=e.sent,e.next=111;break;case 24:if(!Se(f)){e.next=30;break}return e.next=27,this._createFeatureLayerJSON(f,n);case 27:e.t2=e.sent,e.next=110;break;case 30:if(!xe(f)){e.next=36;break}return e.next=33,this._createGeoJSONLayer(f,n);case 33:e.t3=e.sent,e.next=109;break;case 36:if(!ke(f)){e.next=42;break}return e.next=39,this._createGraphicsLayerJSON(f,n);case 39:e.t4=e.sent,e.next=108;break;case 42:if(!Pe(f)){e.next=46;break}e.t5=this._createImageryLayerJSON(f),e.next=107;break;case 46:if(!Le(f)){e.next=52;break}return e.next=49,this._createKMLLayerJSON(f,n);case 49:e.t6=e.sent,e.next=106;break;case 52:if(!Je(f)){e.next=56;break}e.t7=this._createMapImageLayerJSON(f,n),e.next=105;break;case 56:if(!Me(f)){e.next=62;break}return e.next=59,this._createMapNotesLayerJSON(n);case 59:e.t8=e.sent,e.next=104;break;case 62:if(!Ne(f)){e.next=66;break}e.t9=this._createOpenStreetMapLayerJSON(),e.next=103;break;case 66:if(!Ie(f)){e.next=72;break}return e.next=69,this._createStreamLayerJSON(f,n);case 69:e.t10=e.sent,e.next=102;break;case 72:if(!De(f)){e.next=76;break}e.t11=this._createTileLayerJSON(f),e.next=101;break;case 76:if(!Ge(f)){e.next=82;break}return e.next=79,this._createVectorTileLayerJSON(f,n);case 79:e.t12=e.sent,e.next=100;break;case 82:if(!Te(f)){e.next=86;break}e.t13=this._createWebTileLayerJSON(f),e.next=99;break;case 86:if(!Ve(f)){e.next=90;break}e.t14=this._createWMSLayerJSON(f),e.next=98;break;case 90:if(!Re(f)){e.next=94;break}e.t15=this._createWMTSLayerJSON(f),e.next=97;break;case 94:return e.next=96,this._createScreenshotJSON(f,n);case 96:e.t15=e.sent;case 97:e.t14=e.t15;case 98:e.t13=e.t14;case 99:e.t12=e.t13;case 100:e.t11=e.t12;case 101:e.t10=e.t11;case 102:e.t9=e.t10;case 103:e.t8=e.t9;case 104:e.t7=e.t8;case 105:e.t6=e.t7;case 106:e.t5=e.t6;case 107:e.t4=e.t5;case 108:e.t3=e.t4;case 109:e.t2=e.t3;case 110:e.t1=e.t2;case 111:e.t0=e.t1;case 112:(y=e.t0)&&(Array.isArray(y)?a.push.apply(a,Object(s.a)(y)):(y.id=f.id,y.title=this._legendLayerNameMap[f.id]||f.title,y.opacity=f.opacity,y.minScale=f.minScale||0,y.maxScale=f.maxScale||0,a.push(y)));case 114:e.next=7;break;case 116:e.next=121;break;case 118:e.prev=118,e.t16=e.catch(5),l.e(e.t16);case 121:return e.prev=121,l.f(),e.finish(121);case 124:if(c&&a.forEach((function(e){e.minScale=0,e.maxScale=0})),!t.graphics||!t.graphics.length){e.next=129;break}return e.next=127,this._createFeatureCollectionJSON(null,t.graphics,r);case 127:(d=e.sent)&&a.push(d);case 129:return e.abrupt("return",a);case 130:case"end":return e.stop()}}),e,this,[[5,118,121,124]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createBingMapsLayerJSON",value:function(e){return{culture:e.culture,key:e.key,type:"BingMaps"+("aerial"===e.style?"Aerial":"hybrid"===e.style?"Hybrid":"Road")}}},{key:"_createCSVLayerJSON",value:function(){var e=Object(c.a)(i.a.mark((function e(t,r){var a,n,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.layerView,n=r.printTemplate,this._legendLayers&&this._legendLayers.push({id:t.id}),this._is11xService){e.next=6;break}return e.next=4,this._getGraphics(a);case 4:return o=e.sent,e.abrupt("return",this._createFeatureCollectionJSON(t,o,n));case 6:return e.abrupt("return",(s={type:"CSV"},t.write(s,{origin:"web-map"}),delete s.popupInfo,delete s.layerType,s.showLabels=n.showLabels&&t.labelsVisible,s));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createFeatureCollectionJSON",value:function(){var e=Object(c.a)(i.a.mark((function e(t,r,a){var n,s,c,u,l,b,p,f,y,d,h,m,v,O,g,S,x,k,w,_,P,L,J,M,N,I,D;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s={layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}},c={layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}},u={layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}},l={layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}},(b={layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}).layerDefinition.name="textLayer",delete b.layerDefinition.drawingInfo,t&&("esri.layers.FeatureLayer"===t.declaredClass||"esri.layers.StreamLayer"===t.declaredClass?s.layerDefinition.name=c.layerDefinition.name=u.layerDefinition.name=l.layerDefinition.name=this._legendLayerNameMap[t.id]||t.get("arcgisProps.title")||t.title:"esri.layers.GraphicsLayer"===t.declaredClass&&(r=t.graphics.items),t.renderer&&(p=t.renderer.toJSON(),s.layerDefinition.drawingInfo.renderer=p,c.layerDefinition.drawingInfo.renderer=p,u.layerDefinition.drawingInfo.renderer=p,l.layerDefinition.drawingInfo.renderer=p),a.showLabels&&t.labelsVisible&&"function"==typeof t.write&&(d=null==(f=t.write({},{origin:"web-map"}).layerDefinition)||null==(y=f.drawingInfo)?void 0:y.labelingInfo)&&(n=!0,s.layerDefinition.drawingInfo.labelingInfo=d,c.layerDefinition.drawingInfo.labelingInfo=d,u.layerDefinition.drawingInfo.labelingInfo=d,l.layerDefinition.drawingInfo.labelingInfo=d)),null!=t&&t.renderer||n||(delete s.layerDefinition.drawingInfo,delete c.layerDefinition.drawingInfo,delete u.layerDefinition.drawingInfo,delete l.layerDefinition.drawingInfo),m=t&&t.fields,v=t&&t.renderer,!m||!v||"function"!=typeof v.collectRequiredFields){e.next=9;break}return O=new Set,e.next=8,v.collectRequiredFields(O,m);case 8:h=Array.from(O);case 9:m&&(g=m.map((function(e){return e.toJSON()})),s.layerDefinition.fields=g,c.layerDefinition.fields=g,u.layerDefinition.fields=g,l.layerDefinition.fields=g),S=r&&r.length,k=0;case 12:if(!(k<S)){e.next=44;break}if(!1!==(w=r[k]||r.getItemAt(k)).visible&&w.geometry){e.next=16;break}return e.abrupt("continue",41);case 16:if((x=w.toJSON()).hasOwnProperty("popupTemplate")&&delete x.popupTemplate,x.geometry&&x.geometry.z&&delete x.geometry.z,!x.symbol||!x.symbol.outline||"esriCLS"!==x.symbol.outline.type||this._is11xService){e.next=18;break}return e.abrupt("continue",41);case 18:if(!this._is11xService&&x.symbol&&x.symbol.outline&&x.symbol.outline.color&&x.symbol.outline.color[3]&&(x.symbol.outline.color[3]=255),_=t&&t.renderer&&("valueExpression"in t.renderer&&t.renderer.valueExpression||"hasVisualVariables"in t.renderer&&t.renderer.hasVisualVariables()),x.symbol||!t||!t.renderer||!_||this._is11xService){e.next=28;break}return P=t.renderer,e.next=24,P.getSymbolAsync(w);case 24:if(L=e.sent){e.next=27;break}return e.abrupt("continue",41);case 27:x.symbol=L.toJSON(),"hasVisualVariables"in P&&P.hasVisualVariables()&&me(x.symbol,{renderer:P,graphic:w,symbol:L});case 28:if(e.t0=x.symbol,!e.t0){e.next=38;break}if(x.symbol.angle||delete x.symbol.angle,!ze(x.symbol)){e.next=37;break}return e.next=34,this._convertSvgToPictureMarkerSymbolJson(x.symbol);case 34:x.symbol=e.sent,e.next=38;break;case 37:x.symbol.text&&delete x.attributes;case 38:if(a&&a.forceFeatureAttributes||!h||!h.length){e.next=40;break}!function(){var e={};h.forEach((function(t){x.attributes&&x.attributes.hasOwnProperty(t)&&(e[t]=x.attributes[t])})),x.attributes=e}();case 40:"polygon"===w.geometry.type?s.featureSet.features.push(x):"polyline"===w.geometry.type?c.featureSet.features.push(x):"point"===w.geometry.type?x.symbol&&x.symbol.text?b.featureSet.features.push(x):u.featureSet.features.push(x):"multipoint"===w.geometry.type?l.featureSet.features.push(x):"extent"===w.geometry.type&&(x.geometry=j.a.fromExtent(w.geometry).toJSON(),s.featureSet.features.push(x));case 41:k++,e.next=12;break;case 44:J=[s,c,l,u,b].filter((function(e){return e.featureSet.features.length>0})),M=Object(o.a)(J),e.prev=46,M.s();case 48:if((N=M.n()).done){e.next=59;break}if(I=N.value,!(D=I.featureSet.features.every((function(e){return e.symbol})))||a&&a.forceFeatureAttributes||I.featureSet.features.forEach((function(e){delete e.attributes})),D&&delete I.layerDefinition.drawingInfo,e.t1=I.layerDefinition.drawingInfo&&I.layerDefinition.drawingInfo.renderer,!e.t1){e.next=57;break}return e.next=57,this._convertSvgRenderer(I.layerDefinition.drawingInfo.renderer);case 57:e.next=48;break;case 59:e.next=64;break;case 61:e.prev=61,e.t2=e.catch(46),M.e(e.t2);case 64:return e.prev=64,M.f(),e.finish(64);case 67:return e.abrupt("return",J.length?{featureCollection:{layers:J},showLabels:n}:null);case 68:case"end":return e.stop()}}),e,this,[[46,61,64,67]])})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"_createFeatureLayerJSON",value:function(){var e=Object(c.a)(i.a.mark((function e(t,r){var a,n,s,o,c,u,l,b,p,f,y,d,h,m,v;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._legendLayers&&this._legendLayers.push({id:t.id}),o=t.renderer,!(t.featureReduction||o&&"dot-density"===o.type&&(!this._is11xService||parseFloat(this._cimVersion)<2.6))){e.next=4;break}return e.abrupt("return",this._createScreenshotJSON(t,r));case 4:if(c=r.layerView,u=r.printTemplate,l=r.view,b=o&&("valueExpression"in o&&o.valueExpression||"hasVisualVariables"in o&&o.hasVisualVariables()),p="feature-layer"!==(null==(a=t.source)?void 0:a.type)&&"ogc-feature"!==(null==(n=t.source)?void 0:n.type),!(!this._is11xService&&b||t.featureReduction||p)&&o&&(!("field"in o)||null==o.field||"string"==typeof o.field&&t.getField(o.field))){e.next=14;break}return e.next=8,this._getGraphics(c);case 8:return f=e.sent,e.next=11,this._createFeatureCollectionJSON(t,f,u);case 11:s=e.sent,e.next=27;break;case 14:if((s={id:(v=t.write()).id,title:v.title,opacity:v.opacity,minScale:v.minScale,maxScale:v.maxScale,url:v.url,layerDefinition:v.layerDefinition}).showLabels=u.showLabels&&t.labelsVisible,this._setURLandToken(s,t),e.t0=null!=(y=s.layerDefinition)&&null!=(d=y.drawingInfo)&&d.renderer,!e.t0){e.next=24;break}return delete s.layerDefinition.minScale,delete s.layerDefinition.maxScale,e.next=23,this._convertSvgRenderer(s.layerDefinition.drawingInfo.renderer);case 23:e.t0="visualVariables"in o&&o.visualVariables&&o.visualVariables[0];case 24:if(!e.t0){e.next=27;break}"size"===(h=o.visualVariables[0]).type&&h.maxSize&&"number"!=typeof h.maxSize&&h.minSize&&"number"!=typeof h.minSize&&(m=Object(w.getSizeRangeAtScale)(h,l.scale),s.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize=m.minSize,s.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize=m.maxSize);case 27:return e.abrupt("return",s);case 28:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createGeoJSONLayer",value:function(){var e=Object(c.a)(i.a.mark((function e(t,r){var a,n,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.layerView,n=r.printTemplate,this._legendLayers&&this._legendLayers.push({id:t.id}),e.next=4,this._getGraphics(a);case 4:return s=e.sent,e.abrupt("return",this._createFeatureCollectionJSON(t,s,n));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createGraphicsLayerJSON",value:function(){var e=Object(c.a)(i.a.mark((function e(t,r){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.printTemplate,e.abrupt("return",this._createFeatureCollectionJSON(t,null,a));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createImageryLayerJSON",value:function(e){this._legendLayers&&this._legendLayers.push({id:e.id});var t={bandIds:e.bandIds,compressionQuality:e.compressionQuality,format:e.format,interpolation:e.interpolation};if((e.mosaicRule||e.definitionExpression)&&(t.mosaicRule=e.exportImageServiceParameters.mosaicRule.toJSON()),e.renderingRule||e.renderer)if(this._is11xService)e.renderingRule&&(t.renderingRule=e.renderingRule.toJSON()),e.renderer&&(t.layerDefinition=t.layerDefinition||{},t.layerDefinition.drawingInfo=t.layerDefinition.drawingInfo||{},t.layerDefinition.drawingInfo.renderer=e.renderer.toJSON());else{var r=e.exportImageServiceParameters.combineRendererWithRenderingRule();r&&(t.renderingRule=r.toJSON())}return this._setURLandToken(t,e),t}},{key:"_createKMLLayerJSON",value:function(){var e=Object(c.a)(i.a.mark((function e(t,r){var n,o,c,u,l,b;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.printTemplate,!this._is11xService){e.next=4;break}return o={type:"kml"},e.abrupt("return",(t.write(o,{origin:"web-map"}),delete o.layerType,o.url=Object(g.C)(t.url),o));case 4:return c=[],(u=r.layerView).allVisibleMapImages.forEach((function(e,r){var a={id:"".concat(t.id,"_image").concat(r),type:"image",title:t.id,minScale:t.minScale||0,maxScale:t.maxScale||0,opacity:t.opacity,extent:e.extent};"data:image/png;base64,"===e.href.substr(0,22)?a.imageData=e.href.substr(22):a.url=e.href,c.push(a)})),l=[].concat(Object(s.a)(u.allVisiblePoints.items),Object(s.a)(u.allVisiblePolylines.items),Object(s.a)(u.allVisiblePolygons.items)),e.t0=a.a,e.t1={id:t.id},e.next=11,this._createFeatureCollectionJSON(null,l,n);case 11:return e.t2=e.sent,b=(0,e.t0)(e.t1,e.t2),e.abrupt("return",(c.push(b),c));case 14:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createMapImageLayerJSON",value:function(e,t){var r,a=t.view,n={id:e.id,subLayerIds:[]},i=[],s=a.scale;return e.sublayers&&e.sublayers.forEach((function e(t){var r=0===s,a=0===t.minScale||s<=t.minScale,o=0===t.maxScale||s>=t.maxScale;if(t.visible&&(r||a&&o))if(t.sublayers)t.sublayers.forEach(e);else{var c=t.toExportImageJSON(),u={id:t.id,name:t.title,layerDefinition:{drawingInfo:c.drawingInfo,definitionExpression:c.definitionExpression,source:c.source}};i.unshift(u),n.subLayerIds.push(t.id)}})),i.length&&(r={layers:i=i.map((function(e){return{id:e.id,name:e.name,layerDefinition:e.layerDefinition}})),visibleLayers:e.capabilities.exportMap.supportsDynamicLayers?void 0:n.subLayerIds},this._setURLandToken(r,e),this._legendLayers.push(n)),r}},{key:"_createMapNotesLayerJSON",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var r,a,n,c,u,l,b,p,f,d,h,m;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.layerView,a=t.printTemplate,n=[],c=r.layer,!Object(y.i)(c.featureCollections)){e.next=24;break}u=Object(o.a)(c.featureCollections),e.prev=4,u.s();case 6:if((l=u.n()).done){e.next=14;break}return b=l.value,e.next=10,this._createFeatureCollectionJSON(b,b.source,a);case 10:(p=e.sent)&&n.push.apply(n,Object(s.a)(p.featureCollection.layers));case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),u.e(e.t0);case 19:return e.prev=19,u.f(),e.finish(19);case 22:e.next=44;break;case 24:if(!Object(y.i)(c.sublayers)){e.next=44;break}f=Object(o.a)(c.sublayers),e.prev=26,f.s();case 28:if((d=f.n()).done){e.next=36;break}return h=d.value,e.next=32,this._createFeatureCollectionJSON(null,h.graphics,a);case 32:(m=e.sent)&&n.push.apply(n,Object(s.a)(m.featureCollection.layers));case 34:e.next=28;break;case 36:e.next=41;break;case 38:e.prev=38,e.t1=e.catch(26),f.e(e.t1);case 41:return e.prev=41,f.f(),e.finish(41);case 44:return e.abrupt("return",{featureCollection:{layers:n}});case 45:case"end":return e.stop()}}),e,this,[[4,16,19,22],[26,38,41,44]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_createOpenStreetMapLayerJSON",value:function(){return{type:"OpenStreetMap"}}},{key:"_createScreenshotJSON",value:function(){var e=Object(c.a)(i.a.mark((function e(t,r){var a,n,s,o,c,u,l,b,p,f,y,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.printTemplate,n=r.view,s={type:"image"},o={format:"png",ignoreBackground:!0,layers:[t],rotation:0},c=this._ssExtent||n.extent.clone(),u=96,l=!0,b=!0,a.exportOptions&&((p=a.exportOptions).dpi>0&&(u=p.dpi),p.width>0&&(l=p.width%2==n.width%2),p.height>0&&(b=p.height%2==n.height%2)),"map-only"!==a.layout||!a.scalePreserved||a.outScale&&a.outScale!==n.scale||96!==u||l&&b||(o.area={x:0,y:0,width:n.width,height:n.height},l||(o.area.width-=1),b||(o.area.height-=1),this._ssExtent)||(f=n.toMap(Object(S.b)(o.area.width,o.area.height)),c.ymin=f.y,c.xmax=f.x,this._ssExtent=c),s.extent=c.clone()._normalize(!0).toJSON(),e.next=8,n.takeScreenshot(o);case 8:return y=e.sent,d=Object(g.i)(y.dataUrl),e.abrupt("return",(s.imageData=d.data,s));case 11:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createStreamLayerJSON",value:function(){var e=Object(c.a)(i.a.mark((function e(t,r){var a,n,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.layerView,n=r.printTemplate,this._legendLayers&&this._legendLayers.push({id:t.id}),e.next=4,this._getGraphics(a);case 4:return s=e.sent,e.abrupt("return",this._createFeatureCollectionJSON(t,s,n));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createTileLayerJSON",value:function(e){var t={customParameters:e.customParameters};return this._setURLandToken(t,e),t}},{key:"_createVectorTileLayerJSON",value:function(){var e=Object(c.a)(i.a.mark((function e(t,r){var a,n,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this._is11xService&&t.serviceUrl&&t.styleUrl)){e.next=5;break}if(a=x.b&&x.b.findCredential(t.styleUrl),n=x.b&&x.b.findCredential(t.serviceUrl),(a||n)&&"2.1.0"===this._cimVersion){e.next=5;break}return s={type:"VectorTileLayer"},e.abrupt("return",(s.styleUrl=Object(g.C)(t.styleUrl),a&&(s.token=a.token),n&&n.token!==s.token&&(s.additionalTokens=[{url:t.serviceUrl,token:n.token}]),s));case 5:return e.abrupt("return",this._createScreenshotJSON(t,r));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createWebTileLayerJSON",value:function(e){var t={type:"WebTiledLayer",urlTemplate:e.urlTemplate.replace(/\${/g,"{"),credits:e.copyright};return e.subDomains&&e.subDomains.length>0&&(t.subDomains=e.subDomains),t}},{key:"_createWMSLayerJSON",value:function(e){var t,r=[];return e.sublayers&&e.sublayers.forEach((function e(t){t.visible&&(t.sublayers?t.sublayers.forEach(e):t.name&&r.unshift(t.name))})),r.length&&(t={type:"wms",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,transparentBackground:e.imageTransparency,visibleLayers:r,url:Object(g.C)(e.url),version:e.version}),t}},{key:"_createWMTSLayerJSON",value:function(e){var t=e.activeLayer;return{type:"wmts",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,format:t.imageFormat,layer:t.id,style:t.styleId,tileMatrixSet:t.tileMatrixSetId,url:Object(g.C)(e.url)}}},{key:"_setURLandToken",value:function(e,t){var r;if(t.url){e.url=Object(g.C)(e.url||t.url);var a=null==(r=x.b)?void 0:r.findCredential(t.url);a&&(e.token=a.token)}}},{key:"_convertSvgToPictureMarkerSymbolJson",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var r,a,n,s,o,c,u,l,b,p,f,y,d,h,m;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._canvas||(this._canvas=document.createElement("canvas")),r=1024,this._canvas.width=r,this._canvas.height=r,a=this._canvas.getContext("2d"),!t.path){e.next=20;break}if((c=new Path2D(t.path)).closePath(),a.fillStyle=Array.isArray(t.color)?"rgba(".concat(t.color[0],",").concat(t.color[1],",").concat(t.color[2],",").concat(t.color[3]/255,")"):"rgb(0,0,0)",a.fill(c),u=ve(a)){e.next=10;break}return e.abrupt("return",null);case 10:a.clearRect(0,0,r,r),l=Object(S.d)(t.size)/Math.max(u.width,u.height),a.scale(l,l),p=(b=r/l)/2-u.width/2-u.x,f=b/2-u.height/2-u.y,a.translate(p,f),Array.isArray(t.color)&&a.fill(c),null!=(o=t.outline)&&o.width&&Array.isArray(t.outline.color)&&(y=t.outline,a.lineWidth=Object(S.d)(y.width)/l,a.lineJoin="round",a.strokeStyle="rgba(".concat(y.color[0],",").concat(y.color[1],",").concat(y.color[2],",").concat(y.color[3]/255,")"),a.stroke(c),u.width+=a.lineWidth,u.height+=a.lineWidth),u.width*=l,u.height*=l,d=a.getImageData(r/2-u.width/2,r/2-u.height/2,Math.ceil(u.width),Math.ceil(u.height)),n=d.width,s=d.height,a.canvas.width=n,a.canvas.height=s,a.putImageData(d,0,0),e.next=25;break;case 20:return h="image/svg+xml"===t.contentType?"data:image/svg+xml;base64,"+t.imageData:t.url,e.next=23,Object(k.default)(h,{responseType:"image"});case 23:m=e.sent.data,n=Object(S.d)(t.width),s=Object(S.d)(t.height),a.canvas.width=n,a.canvas.height=s,a.drawImage(m,0,0,a.canvas.width,a.canvas.height);case 25:return e.abrupt("return",{type:"esriPMS",imageData:a.canvas.toDataURL("image/png").substr(22),angle:t.angle,contentType:"image/png",height:Object(S.e)(s),width:Object(S.e)(n),xoffset:t.xoffset,yoffset:t.yoffset});case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_convertSvgRenderer",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var r,a,n,s,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("simple"!==(r=t.type)||!ze(t.symbol)){e.next=7;break}return e.next=4,this._convertSvgToPictureMarkerSymbolJson(t.symbol);case 4:t.symbol=e.sent,e.next=35;break;case 7:if("uniqueValue"!==r&&"classBreaks"!==r){e.next=35;break}if(e.t0=ze(t.defaultSymbol),!e.t0){e.next=13;break}return e.next=12,this._convertSvgToPictureMarkerSymbolJson(t.defaultSymbol);case 12:t.defaultSymbol=e.sent;case 13:if(!(a=t["uniqueValue"===r?"uniqueValueInfos":"classBreakInfos"])){e.next=35;break}n=Object(o.a)(a),e.prev=16,n.s();case 18:if((s=n.n()).done){e.next=27;break}if(c=s.value,e.t1=ze(c.symbol),!e.t1){e.next=25;break}return e.next=24,this._convertSvgToPictureMarkerSymbolJson(c.symbol);case 24:c.symbol=e.sent;case 25:e.next=18;break;case 27:e.next=32;break;case 29:e.prev=29,e.t2=e.catch(16),n.e(e.t2);case 32:return e.prev=32,n.f(),e.finish(32);case 35:case"end":return e.stop()}}),e,this,[[16,29,32,35]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_getGraphics",value:function(e){return e.queryFeatures(qe).then((function(e){return e.features}))}},{key:"_getPrintDefinition",value:function(){var e=Object(c.a)(i.a.mark((function e(t,r){var a,n,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.view,n=a.spatialReference,e.next=4,this._createOperationalLayers(a,r);case 4:return e.t0=e.sent,s={operationalLayers:e.t0},o=this._ssExtent||t.extent||a.extent,e.abrupt("return",(n&&n.isWrappable&&(o=o.clone()._normalize(!0),n=o.spatialReference),s.mapOptions={extent:o&&o.toJSON(),spatialReference:n&&n.toJSON(),showAttribution:r.attributionVisible},this._ssExtent=null,a.background&&(s.background=a.background.toJSON()),a.rotation&&(s.mapOptions.rotation=-a.rotation),r.scalePreserved&&(s.mapOptions.scale=r.outScale||a.scale),s));case 8:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getGpPrintParams",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var r,a,n,s,o,c,u,l,b,p,f,y,d,h,m,v,g,j=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null==(r=t.template||new Ce).showLabels&&(r.showLabels=!0),a=r.exportOptions,s=ye(r.layout),a&&(n={dpi:a.dpi},("map_only"===s.toLowerCase()||""===s)&&(o=a.width,c=a.height,n.outputSize=[o,c])),(u=r.layoutOptions)&&("Miles"===u.scalebarUnit||"Kilometers"===u.scalebarUnit?(b="Kilometers",p="Miles"):"Meters"!==u.scalebarUnit&&"Feet"!==u.scalebarUnit||(b="Meters",p="Feet"),l={titleText:u.titleText,authorText:u.authorText,copyrightText:u.copyrightText,customTextElements:u.customTextElements,scaleBarOptions:{metricUnit:Ae.toJSON(b),metricLabel:Ee[b],nonMetricUnit:Ae.toJSON(p),nonMetricLabel:Ee[p]}}),f=null,u&&u.legendLayers&&(f=u.legendLayers.map((function(e){j._legendLayerNameMap[e.layerId]=e.title;var t={id:e.layerId};return e.subLayerIds&&(t.subLayerIds=e.subLayerIds),t}))),e.next=11,this._getPrintDefinition(t,r);case 11:return(y=e.sent).operationalLayers&&(d=new RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),h=/[\u0600-\u06FF]/,m=function(e){var t=e.text,r=e.font,a=r&&r.family&&r.family.toLowerCase();t&&r&&("arial"===a||"arial unicode ms"===a)&&(r.family=d.test(t)?"Arial Unicode MS":"Arial","normal"!==r.style&&h.test(t)&&(r.family="Arial Unicode MS"))},v=function(){throw new O.a("print-task:cim-symbol-unsupported","CIMSymbol is not supported by a print service published from ArcMap")},y.operationalLayers.forEach((function(e){var t,r,a;null!=(t=e.featureCollection)&&t.layers?e.featureCollection.layers.forEach((function(e){var t,r,a,n;if(null!=(t=e.layerDefinition)&&null!=(r=t.drawingInfo)&&null!=(a=r.renderer)&&a.symbol){var i=e.layerDefinition.drawingInfo.renderer;"esriTS"===i.symbol.type?m(i.symbol):"CIMSymbolReference"!==i.symbol.type||j._is11xService||v()}null!=(n=e.featureSet)&&n.features&&e.featureSet.features.forEach((function(e){e.symbol&&("esriTS"===e.symbol.type?m(e.symbol):"CIMSymbolReference"!==e.symbol.type||j._is11xService||v())}))})):!j._is11xService&&null!=(r=e.layerDefinition)&&null!=(a=r.drawingInfo)&&a.renderer&&JSON.stringify(e.layerDefinition.drawingInfo.renderer).includes('"type":"CIMSymbolReference"')&&v()}))),t.outSpatialReference&&(y.mapOptions.spatialReference=t.outSpatialReference.toJSON()),Object.assign(y,{exportOptions:n,layoutOptions:l||{}}),Object.assign(y.layoutOptions,{legendOptions:{operationalLayers:null!=f?f:this._legendLayers.slice()}}),this._legendLayers.length=0,g={Web_Map_as_JSON:JSON.stringify(y),Format:pe(r.format),Layout_Template:s},e.abrupt("return",(t.extraParameters&&Object.assign(g,t.extraParameters),g));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(P.a);Object(f.a)([Object(h.b)()],We.prototype,"_geoprocessor",null),Object(f.a)([Object(h.b)()],We.prototype,"_gpMetadata",void 0),Object(f.a)([Object(h.b)({readOnly:!0})],We.prototype,"mode",null),Object(f.a)([Object(h.b)()],We.prototype,"updateDelay",void 0);var Ze=We=Object(f.a)([Object(v.a)("esri.tasks.PrintTask")],We);t.default=Ze}}]);
//# sourceMappingURL=90.5a1da669.chunk.js.map