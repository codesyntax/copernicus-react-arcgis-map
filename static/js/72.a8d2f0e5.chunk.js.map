{"version":3,"sources":["../node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js","../node_modules/@arcgis/core/views/support/drapedUtils.js","../node_modules/@arcgis/core/views/layers/TileLayerView.js","../node_modules/@arcgis/core/views/2d/layers/TileLayerView2D.js"],"names":["t","e","xoffset","Math","max","abs","yoffset","n","stops","length","r","s","size","filter","type","map","maxSize","minSize","o","f","floor","renderer","event","pointerType","visualVariables","symbol","uniqueValueInfos","forEach","classBreakInfos","a","i","resolution","overlayPixelSizeInMapUnits","basemapSpatialReference","equals","spatialReference","m","x","p","y","c","l","xmin","min","ymin","xmax","ymax","this","layer","Promise","reject","get","allSublayers","toArray","minScale","maxScale","popupTemplate","popupEnabled","visible","createQuery","geometry","createFetchPopupFeaturesQueryGeometry","getRequiredFields","outFields","queryFeatures","features","then","concat","value","Boolean","prototype","w","getLogger","d","_","arguments","_tileStrategy","_fetchQueue","tileInfo","view","watch","refresh","addResolvingPromise","resampling","pause","state","update","resume","notifyChange","tileServers","_tileInfoView","fullExtent","tileInfoView","concurrency","process","fetchTile","u","cachePolicy","acquireTile","releaseTile","requestUpdate","container","requestRender","destroy","clear","removeAllChildren","updateRequested","suspended","reset","tiles","_enqueueTileFetch","_bitmapView","createTile","bitmap","getTileCoords","key","getTileResolution","width","height","addChild","abort","id","removeChild","once","tilemapCache","signal","_fetchImage","_createBlankImage","fetchAvailabilityUpsample","level","row","col","h","_resampleImage","has","push","source","error","timestamp","refreshTimestamp","getLODInfoAt","getXForColumn","getYForRow","g","round","getContext","drawImage","document","createElement","I"],"mappings":"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","file":"static/js/72.a8d2f0e5.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nfunction t(t,e){return e?\"xoffset\"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):\"yoffset\"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function e(t){let e=0,n=0;for(let r=0;r<t.length;r++){const s=t[r].size;\"number\"==typeof s&&(e+=s,n++)}return e/n}function n(t,n){return\"number\"==typeof t?t:t&&t.stops&&t.stops.length?e(t.stops):n}function r(t,e){if(!e)return t;const r=e.filter((t=>\"size\"===t.type)).map((e=>{const{maxSize:r,minSize:s}=e;return(n(r,t)+n(s,t))/2}));let s=0;const o=r.length;if(0===o)return t;for(let n=0;n<o;n++)s+=r[n];const f=Math.floor(s/o);return Math.max(f,t)}function s(e){const n=e&&e.renderer,s=\"touch\"===(e&&e.event&&e.event.pointerType)?9:6;if(!n)return s;const o=\"visualVariables\"in n?r(s,n.visualVariables):s;if(\"simple\"===n.type)return t(o,n.symbol);if(\"unique-value\"===n.type){let e=o;return n.uniqueValueInfos.forEach((n=>{e=t(e,n.symbol)})),e}if(\"class-breaks\"===n.type){let e=o;return n.classBreakInfos.forEach((n=>{e=t(e,n.symbol)})),e}return n.type,o}export{s as calculateTolerance};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t}from\"../../core/maybe.js\";import r from\"../../geometry/Extent.js\";import\"../../geometry.js\";import{getMetersPerUnitForSR as n}from\"../../core/unitUtils.js\";import{calculateTolerance as i}from\"../../renderers/support/clickToleranceUtils.js\";function a(t,i,a,o=new r){let s;if(\"2d\"===a.type)s=i*a.resolution;else if(\"3d\"===a.type){const r=a.overlayPixelSizeInMapUnits(t),o=a.basemapSpatialReference;s=e(o)&&!o.equals(a.spatialReference)?n(o)/n(a.spatialReference):i*r}const m=t.x-s,p=t.y-s,c=t.x+s,l=t.y+s,{spatialReference:f}=a;return o.xmin=Math.min(m,c),o.ymin=Math.min(p,l),o.xmax=Math.max(m,c),o.ymax=Math.max(p,l),o.spatialReference=f,o}function o(e,r,n){const o=n.toMap(e);if(t(o))return!1;return a(o,i(),n,s).intersects(r)}const s=new r;export{a as createQueryGeometry,o as intersectsDrapedGeometry};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import{isSome as r}from\"../../core/maybe.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as o}from\"../../core/accessorSupport/decorators/subclass.js\";import s from\"../../core/Error.js\";import\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import\"../../portal/support/resourceExtension.js\";import{eachAlways as p}from\"../../core/promiseUtils.js\";import{calculateTolerance as a}from\"../../renderers/support/clickToleranceUtils.js\";const i=i=>{let c=class extends i{async fetchPopupFeatures(e,t){const{layer:o}=this;if(!e)return Promise.reject(new s(\"tilelayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:o}));if(\"tile\"!==o.type)return Promise.reject(new s(\"tilelayerview:fetchPopupFeatures\",\"Layer type should be 'tile'\",{type:o.type}));const i=this.get(\"view.scale\"),c=o.allSublayers.toArray().filter((e=>{const r=0===e.minScale||i<=e.minScale,t=0===e.maxScale||i>=e.maxScale;return e.popupTemplate&&e.popupEnabled&&e.visible&&r&&t}));return p(c.map((async o=>{const s=o.createQuery(),p=r(t)?t.event:null,i=a({renderer:o.renderer,event:p});s.geometry=this.createFetchPopupFeaturesQueryGeometry(e,i),s.outFields=await o.popupTemplate.getRequiredFields();return(await o.queryFeatures(s)).features}))).then((e=>[].concat(...e.map((e=>e.value)).filter(Boolean))))}};return e([t()],c.prototype,\"layer\",void 0),c=e([o(\"esri.layers.mixins.TileLayerView\")],c),c};export default i;export{i as TileLayerView};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import{isNone as t}from\"../../../core/maybe.js\";import i from\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import a from\"../../../core/Error.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{isAbortError as l}from\"../../../core/promiseUtils.js\";import o from\"../tiling/TileKey.js\";import{RefreshableLayerView as h}from\"../../layers/RefreshableLayerView.js\";import n from\"../tiling/TileInfoView.js\";import c from\"../tiling/TileQueue.js\";import u from\"../tiling/TileStrategy.js\";import m from\"../../layers/LayerView.js\";import{createQueryGeometry as p}from\"../../support/drapedUtils.js\";import{TileLayerView as f}from\"../../layers/TileLayerView.js\";import{LayerView2DMixin as g}from\"./LayerView2D.js\";import{BitmapTileLayerView2D as y}from\"./BitmapTileLayerView2D.js\";const w=i.getLogger(\"esri.views.2d.layers.TileLayerView2D\"),d=[0,0];let _=class extends(f(h(y(g(m))))){constructor(){super(...arguments),this._tileStrategy=null,this._fetchQueue=null,this.layer=null}initialize(){const e=this.layer.tileInfo,t=e&&e.spatialReference;let i;t||(i=new a(\"layerview:tiling-information-missing\",\"The layer doesn't provide tiling information\",{layer:this.layer})),t.equals(this.view.spatialReference)||(i=new a(\"layerview:spatial-reference-incompatible\",\"The spatial reference of this layer does not meet the requirements of the view\",{layer:this.layer})),this.watch(\"resampling\",(()=>{this.refresh()})),i&&this.addResolvingPromise(Promise.reject(i))}get resampling(){return!(\"resampling\"in this.layer)||!1!==this.layer.resampling}hitTest(){return null}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume(),this.notifyChange(\"updating\")}attach(){const e=\"tileServers\"in this.layer?this.layer.tileServers:null;this._tileInfoView=new n(this.layer.tileInfo,this.layer.fullExtent),this._fetchQueue=new c({tileInfoView:this._tileInfoView,concurrency:e&&10*e.length||10,process:(e,t)=>this.fetchTile(e,t)}),this._tileStrategy=new u({cachePolicy:\"keep\",resampling:this.resampling,acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView}),this.requestUpdate(),this.container.requestRender(),super.attach()}detach(){super.detach(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQueryGeometry(e,t){return p(e,t,this.view)}async doRefresh(){this.updateRequested||this.suspended||(this._fetchQueue.reset(),this._tileStrategy.tiles.forEach((e=>this._enqueueTileFetch(e))),this.notifyChange(\"updating\"))}isUpdating(){var e;return(null==(e=this._fetchQueue)?void 0:e.length)>0}acquireTile(e){const t=this._bitmapView.createTile(e),i=t.bitmap;return[i.x,i.y]=this._tileInfoView.getTileCoords(d,t.key),i.resolution=this._tileInfoView.getTileResolution(t.key),[i.width,i.height]=this._tileInfoView.tileInfo.size,this._enqueueTileFetch(t),this._bitmapView.addChild(t),this.requestUpdate(),t}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once(\"detach\",(()=>e.destroy())),this.requestUpdate()}async fetchTile(e,i){const r=\"tilemapCache\"in this.layer?this.layer.tilemapCache:null,s=!t(i)&&i.signal;if(!r)try{return await this._fetchImage(e,s)}catch(m){if(!l(m)&&!this.resampling)return this._createBlankImage();throw m}const a=new o(0,0,0,0);let h;try{if(await r.fetchAvailabilityUpsample(e.level,e.row,e.col,a,{signal:s}),a.level!==e.level&&!this.resampling)return this._createBlankImage();h=await this._fetchImage(a,s)}catch(m){if(l(m))throw m;h=await this._fetchImage(e,s)}const{level:n,row:c,col:u}=a;return this.resampling&&n!==e.level?this._resampleImage(h,n,c,u,e.level,e.row,e.col):h}async _enqueueTileFetch(e){if(!this._fetchQueue.has(e.key.id)){try{const t=await this._fetchQueue.push(e.key);e.bitmap.source=t,e.bitmap.width=this._tileInfoView.tileInfo.size[0],e.bitmap.height=this._tileInfoView.tileInfo.size[1],e.once(\"attach\",(()=>this.requestUpdate()))}catch(t){l(t)||w.error(t)}this.requestUpdate()}}async _fetchImage(e,t){return this.layer.fetchTile(e.level,e.row,e.col,{timestamp:this.refreshTimestamp,signal:t})}_resampleImage(e,t,i,r,s,a,l){const o=this._tileInfoView.tileInfo.size,h=this._tileInfoView.getTileResolution(t),n=this._tileInfoView.getTileResolution(s);let c=this._tileInfoView.getLODInfoAt(s);const u=c.getXForColumn(l),m=c.getYForRow(a);c=this._tileInfoView.getLODInfoAt(t);const p=c.getXForColumn(r),f=c.getYForRow(i),g=Math.round((u-p)/h),y=Math.round(-(m-f)/h),w=Math.round(o[0]*(n/h)),d=Math.round(o[1]*(n/h)),_=this._createBlankImage();return _.getContext(\"2d\").drawImage(e,g,y,w,d,0,0,o[0],o[1]),_}_createBlankImage(){const e=this._tileInfoView.tileInfo.size,t=document.createElement(\"canvas\");return[t.width,t.height]=e,t}};e([r()],_.prototype,\"resampling\",null),_=e([s(\"esri.views.2d.layers.TileLayerView2D\")],_);var I=_;export default I;\n"],"sourceRoot":""}